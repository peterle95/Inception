# [Block: Server]: Defines a virtual server configuration
# Parameters: None (block context)
# Default: None
# Security: Isolates configuration for specific domains/ports
# Performance: Nginx selects server based on listen/server_name
# Example: server { ... }
server {
    # [Directive: listen]: Sets address and port for IP
    # Parameters: address[:port] [ssl] [http2] ...
    # Default: 80
    # Security: Ensure only necessary ports are open
    # Performance: Bind to specific IPs if possible
    # Example: listen 80;
    listen 443 ssl;

    # [Directive: listen]: Sets address and port for IPv6
    # Parameters: address[:port] [ssl] ...
    # Default: 80
    # Security: Ensure IPv6 security policies match IPv4
    # Performance: Enables IPv6 connectivity
    # Example: listen [::]:80;
    listen [::]:443 ssl;

    # [Directive: server_name]: Names of the virtual server
    # Parameters: name ...
    # Default: ""
    # Security: Prevents host header attacks if configured correctly
    # Performance: Used for hash table lookup of server
    # Example: server_name example.com;
    server_name pmolzer.42.fr;

    # [Directive: ssl_certificate]: Specifies file with PEM certificate
    # Parameters: file
    # Default: None
    # Security: Must be valid and protected
    # Performance: Parsing large chains can add startup time
    # Example: ssl_certificate /etc/ssl/certs/cert.pem;
    ssl_certificate /etc/nginx/ssl/inception.crt;

    # [Directive: ssl_certificate_key]: Specifies file with secret key
    # Parameters: file
    # Default: None
    # Security: CRITICAL - Must be restricted access (chmod 600)
    # Performance: None
    # Example: ssl_certificate_key /etc/ssl/private/key.pem;
    ssl_certificate_key /etc/nginx/ssl/inception.key;

    # [Directive: ssl_protocols]: Enables specified SSL/TLS protocols
    # Parameters: [SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]
    # Default: TLSv1 TLSv1.1 TLSv1.2
    # Security: Disable older protocols (SSLv3, TLSv1.0/1.1) to prevent attacks
    # Performance: Newer protocols (TLSv1.3) offer faster handshakes
    # Example: ssl_protocols TLSv1.2 TLSv1.3;
    ssl_protocols TLSv1.3;

    # [Directive: root]: Sets root directory for requests
    # Parameters: path
    # Default: html
    # Security: Ensure proper permissions on directory
    # Performance: Nginx looks here for static files
    # Example: root /var/www/html;
    root /var/www/html;

    # [Directive: index]: Defines index files for directories
    # Parameters: file ...
    # Default: index.html
    # Security: None directly, but affects what is shown
    # Performance: Checked in order
    # Example: index index.html;
    index index.php index.html index.htm;

    # [Block: location]: Configures settings for a specific request URI
    # Parameters: [ = | ~ | ~* | ^~ ] uri
    # Default: None
    # Security: Can restrict access to specific paths
    # Performance: Order matters (regex vs prefix)
    # Example: location / { ... }
    location / {
        # [Directive: try_files]: Checks existence of files in order
        # Parameters: file ... uri
        # Default: None
        # Security: Prevents unauthorized file access if configured well
        # Performance: Avoids internal redirects if file found
        # Example: try_files $uri /index.html;
        try_files $uri $uri/ /index.php?$args;
    }

    # [Block: location]: Regex match for PHP files
    # Parameters: ~ regex
    # Default: None
    # Security: Ensure only .php files are passed to backend
    # Performance: Regex matching cost
    # Example: location ~ \.php$ { ... }
    location ~ \.php$ {
        # [Directive: fastcgi_split_path_info]: Defines regex to capture split path
        # Parameters: regex
        # Default: None
        # Security: Correctly identifies script vs path info
        # Performance: Regex overhead
        # Example: fastcgi_split_path_info ^(.+\.php)(.*)$;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;

        # [Directive: fastcgi_pass]: Sets address of FastCGI server
        # Parameters: address
        # Default: None
        # Security: Ensure backend is trusted
        # Performance: Network latency to backend
        # Example: fastcgi_pass 127.0.0.1:9000;
        fastcgi_pass wordpress:9000;

        # [Directive: fastcgi_index]: Sets index file for FastCGI
        # Parameters: name
        # Default: None
        # Security: None
        # Performance: None
        # Example: fastcgi_index index.php;
        fastcgi_index index.php;

        # [Directive: include]: Includes another configuration file
        # Parameters: file
        # Default: None
        # Security: Ensure included file is secure
        # Performance: Slight parsing overhead
        # Example: include mime.types;
        include fastcgi_params;

        # [Directive: fastcgi_param]: Sets parameter to be passed to FastCGI server
        # Parameters: parameter value
        # Default: None
        # Security: Sanitize inputs if dynamic
        # Performance: Minimal
        # Example: fastcgi_param REQUEST_METHOD $request_method;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

        # [Directive: fastcgi_param]: Sets parameter to be passed to FastCGI server
        # Parameters: parameter value
        # Default: None
        # Security: Sanitize inputs if dynamic
        # Performance: Minimal
        # Example: fastcgi_param REQUEST_METHOD $request_method;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # [Block: location]: Regex match for hidden files (starting with dot)
    # Parameters: ~ regex
    # Default: None
    # Security: Prevents access to .git, .env, etc.
    # Performance: Regex overhead
    # Example: location ~ /\. { ... }
    location ~ /\. {
        # [Directive: deny]: Denies access to specific address or all
        # Parameters: address | all
        # Default: None
        # Security: Access control
        # Performance: Fast rejection
        # Example: deny all;
        deny all;
    }
}
